# 08-1. ë°ì´í„° ì§‘ê³„í•˜ê¸°
### groupby() ë©”ì„œë“œë¡œ ë°ì´í„° ì§‘ê³„í•˜ê¸°
1. ê°­ë§ˆì¸ë” ë°ì´í„°ì…‹ì„ í™œìš©í•œë‹¤
```
          country continent  year  lifeExp       pop   gdpPercap
0     Afghanistan      Asia  1952   28.801   8425333  779.445314
1     Afghanistan      Asia  1957   30.332   9240934  820.853030
2     Afghanistan      Asia  1962   31.997  10267083  853.100710
3     Afghanistan      Asia  1967   34.020  11537966  836.197138
4     Afghanistan      Asia  1972   36.088  13079460  739.981106
...           ...       ...   ...      ...       ...         ...
1699     Zimbabwe    Africa  1987   62.351   9216418  706.157306
1700     Zimbabwe    Africa  1992   60.377  10704340  693.420786
1701     Zimbabwe    Africa  1997   46.809  11404948  792.449960
1702     Zimbabwe    Africa  2002   39.989  11926563  672.038623
1703     Zimbabwe    Africa  2007   43.487  12311143  469.709298

[1704 rows x 6 columns]
```
2. groupby ë©”ì„œë“œë¡œ yearì—´ì„ ê¸°ì¤€ìœ¼ë¡œ ë°ì´í„°ë¥¼ ê·¸ë£¹í™”í•˜ê³  mean ë©”ì„œë“œë¡œ lifeExp ì—´ì˜ í‰ê·  êµ¬í•˜ê¸°
```python
avg_life_exp_by_year = df.groupby('year')["lifeExp"].mean()
print(avg_life_exp_by_year)
```
ğŸ“ ì‹¤í–‰ê²°ê³¼
```
year
1952    49.057620
1957    51.507401
1962    53.609249
1967    55.678290
1972    57.647386
1977    59.570157
1982    61.533197
1987    63.212613
1992    64.160338
1997    65.014676
2002    65.694923
2007    67.007423
Name: lifeExp, dtype: float64year
```

3. groupby() ë©”ì„œë“œëŠ” ì—´ì˜ ê³ ìœ³ê°’ ë˜ëŠ” ì—¬ëŸ¬ ì—´ì„ ì¡°í•©í•œ ê³ ìœ³ê°’ì˜ í•˜ìœ„ ì§‘í•©ì„ ìƒì„±í•˜ëŠ” ì—­í• ì„ í•œë‹¤.
```python
years = df.year.unique()
print(years)
```
ğŸ“ ì‹¤í–‰ê²°ê³¼
```
[1952 1957 1962 1967 1972 1977 1982 1987 1992 1997 2002 2007]
```

4. ê³ ìœ³ê°’ë³„ë¡œ ë°ì´í„°ì˜ í•˜ìœ„ ì§‘í•©ì„ ì¶”ì¶œ. year ì—´ì˜ ê³ ìœ³ê°’ í•˜ë‚˜ë¥¼ ê³¨ë¼ í•´ë‹¹ ì—°ë„ì˜ ë°ì´í„°ë¥¼ ì‚´í´ë³¸ë‹¤.
```python
y=1952 = df.loc[df.year == 1952, :]
print(y1952)
```
ğŸ“ ì‹¤í–‰ê²°ê³¼
```
                 country continent  year  lifeExp       pop    gdpPercap
0            Afghanistan      Asia  1952   28.801   8425333   779.445314
12               Albania    Europe  1952   55.230   1282697  1601.056136
24               Algeria    Africa  1952   43.077   9279525  2449.008185
36                Angola    Africa  1952   30.015   4232095  3520.610273
48             Argentina  Americas  1952   62.485  17876956  5911.315053
...                  ...       ...   ...      ...       ...          ...
1644             Vietnam      Asia  1952   40.412  26246839   605.066492
1656  West Bank and Gaza      Asia  1952   43.160   1030585  1515.592329
1668         Yemen, Rep.      Asia  1952   32.548   4963829   781.717576
1680              Zambia    Africa  1952   42.038   2672000  1147.388831
1692            Zimbabwe    Africa  1952   48.451   3080907   406.884115

[142 rows x 6 columns]
```

5. ì¶”ì¶œí•œ í•˜ìœ„ ì§‘í•©ì—ë„ ë©”ì„œë“œë¥¼ ì ìš©í•  ìˆ˜ ìˆë‹¤. lifeExp ì—´ì˜ í‰ê· ì„ êµ¬í•´ë³¸ë‹¤
```python
y1952_mean = y1952["lifeExp"].mean()
print(y1952_mean)
```
ğŸ“ ì‹¤í–‰ê²°ê³¼
```
49.057619718309866
```

## groupby() ë©”ì„œë“œì™€ í•¨ê»˜ ì‚¬ìš©í•˜ëŠ” ì§‘ê³„ ë©”ì„œë“œ
1. describe()ë¥¼ ì‚¬ìš©í•˜ë©´ ì—¬ëŸ¬ ìš”ì•½ í†µê²Œë¥¼ í™•ì¸í•  ìˆ˜ ìˆë‹¤.
2. continent ì—´ë¡œ ê·¸ë£¹í™” í•˜ê³  descibe() ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ë©´ ëŒ€ë¥™ë³„ ìš”ì•½ í†µê³„ë¥¼ í™•ì¸í•  ìˆ˜ ìˆë‹¤.
```python
continent_describe = df.groupby('continent')["lifeExp"].descibe()
print(continent_descibe)
```
ğŸ“ ì‹¤í–‰ê²°ê³¼
```
           count       mean        std     min       25%      50%       75%  \
continent                                                                     
Africa     624.0  48.865330   9.150210  23.599  42.37250  47.7920  54.41150   
Americas   300.0  64.658737   9.345088  37.579  58.41000  67.0480  71.69950   
Asia       396.0  60.064903  11.864532  28.801  51.42625  61.7915  69.50525   
Europe     360.0  71.903686   5.433178  43.585  69.57000  72.2410  75.45050   
Oceania     24.0  74.326208   3.795611  69.120  71.20500  73.6650  77.55250   

              max  
continent          
Africa     76.442  
Americas   80.653  
Asia       82.603  
Europe     81.757  
Oceania    81.235
```

## agg() ë©”ì„œë“œì™€ groupby() ë©”ì„œë“œ ì¡°í•©í•˜ê¸°
### ë‹¤ë¥¸ ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ ì§‘ê³„ í•¨ìˆ˜ ì‚¬ìš©í•˜ê¸°
1. agg() ë©”ì„œë“œì— ë„˜íŒŒì´ì˜ mean() í•¨ìˆ˜ë¥¼ ì „ë‹¬í•˜ì—¬ í‰ê· ì„ êµ¬í•  ìˆ˜ ìˆë‹¤.
```python
import numpy as np

cont_le_agg = df.groupby('continent')["lifeExp"].agg(np.mean)
print(cont_le_agg)
```
ğŸ“ ì‹¤í–‰ê²°ê³¼
```
continent
Africa      48.865330
Americas    64.658737
Asia        60.064903
Europe      71.903686
Oceania     74.326208
Name: lifeExp, dtype: float64
```
### ì‚¬ìš©ì ì§‘ê³„í•¨ìˆ˜ ì‚¬ìš©í•˜ê¸°
* ë¼ì´ë¸ŒëŸ¬ë¦¬ì—ì„œ ì œê³µí•˜ëŠ” ì§‘ê³„ ë©”ì„œë“œë¡œëŠ” ì›í•˜ëŠ” ê°’ì„ ê³„ì‚°í•  ìˆ˜ ì—†ë‹¤ë©´ ì§ì ‘ í•¨ìˆ˜ë¥¼ ë§Œë“¤ì–´ì„œ agg()ì— ì „ë‹¬í•˜ë©´ ë¨
1. í‰ê· ì„ êµ¬í•˜ëŠ” í•¨ìˆ˜ ì§ì ‘ ë§Œë“¤ê¸°
```python
def my_mean(values):
  n = len(values)
  sum = 0
  for value in values:
    sum += value
  return sum / n
```
2. agg()ì— my_meanìœ¼ë¡œ ì „ë‹¬í•˜ê¸°
```python
agg_my_mean = df.groupby('year')["lifeExp"].agg(my_mean)
print(agg_my_mean)
```
ğŸ“ ì‹¤í–‰ê²°ê³¼
```
year
1952    49.057620
1957    51.507401
1962    53.609249
1967    55.678290
1972    57.647386
1977    59.570157
1982    61.533197
1987    63.212613
1992    64.160338
1997    65.014676
2002    65.694923
2007    67.007423
Name: lifeExp, dtype: float64
```
3. ë§¤ê°œë³€ìˆ˜ê°€ ì—¬ëŸ¬ê°œì¸ ì‚¬ìš©ì í•¨ìˆ˜ ì „ë‹¬í•˜ê¸°
* ì‚¬ìš©ì í•¨ìˆ˜ì˜ ì²« ë²ˆì§¸ ë§¤ê°œë³€ìˆ˜ê°€ ë°ì´í„°í”„ë ˆì„ì˜ ì‹œë¦¬ì¦ˆì—¬ì•¼ í•œë‹¤.
* ì—°ë„ë‚˜ ëŒ€ë¥™ê³¼ ìƒê´€ì—†ì´ ì „ì²´ ê¸°ëŒ€ ìˆ˜ëª…ì˜ í‰ê·  diff_valueì™€ ê° ê·¸ë£¹ í‰ê·  ìˆ˜ëª…ì˜ ì°¨ì´ë¥¼ ê³„ì‚°í•˜ëŠ” my_mean_diff() í•¨ìˆ˜ë¥¼ ìƒì„±
```python
def my_mean_diff(values, diff_value):
  n = len(value)
  sum = 0
  for value in values:
    sum += values
  mean = sum / n
  return (mean-diff_value)
```
4. ëª¨ë“  ê¸°ëŒ€ ìˆ˜ëª…ì˜ í‰ê· 
```python
global_mean = df["lifeExp"].mean()
print(global_mean)
```
ğŸ“ ì‹¤í–‰ê²°ê³¼
```
59.474439366197174
```
5. my_mean_diff()í•¨ìˆ˜ë¥¼ agg() ë©”ì„œë“œì— ì „ë‹¬
```python
agg_mean_diff = (
  df
  .groupby("year")
  ["lifeExp"]
  .agg(my_mean_diff, diff_value = global_mean) # ì²« ë²ˆì§¸ ë§¤ê°œë³€ìˆ˜ëŠ” í•¨ìˆ˜ ì´ë¦„, ë‘ ë²ˆì§¸ë¶€í„°ëŠ” í•¨ìˆ˜ì˜ ë§¤ê°œë³€ìˆ˜ ì´ë¦„ê³¼ í•¨ê»˜ ì „ë‹¬
)

print(agg_mean_diff)
```
ğŸ“ ì‹¤í–‰ê²°ê³¼
```
year
1952   -10.416820
1957    -7.967038
1962    -5.865190
1967    -3.796150
1972    -1.827053
1977     0.095718
1982     2.058758
1987     3.738173
1992     4.685899
1997     5.540237
2002     6.220483
2007     7.532983
Name: lifeExp, dtype: float64
```
## ì—¬ëŸ¬ ê°œì˜ ì§‘ê³„ í•¨ìˆ˜ í•œ ë²ˆì— ì‚¬ìš©í•˜ê¸°
* ì—¬ëŸ¬ ê°œì˜ ì§‘ê³„í•¨ìˆ˜ë¥¼ í•œ ë²ˆì— ì‚¬ìš©í•˜ê³  ì‹¶ë‹¤ë©´ ì§‘ê²Œ í•¨ìˆ˜ë“¤ì„ ë¦¬ìŠ¤íŠ¸ í˜•ì‹ìœ¼ë¡œ agg() ë©”ì„œë“œì— ì „ë‹¬
```python
gdf = (
  df
  .groupby("year")
  ["lifeExp"]
  .agg([np.count_nonzero, np.mean, np.std])
)

print(gdf)
```
ğŸ“ ì‹¤í–‰ê²°ê³¼
```
      count_nonzero       mean        std
year                                     
1952            142  49.057620  12.225956
1957            142  51.507401  12.231286
1962            142  53.609249  12.097245
1967            142  55.678290  11.718858
1972            142  57.647386  11.381953
1977            142  59.570157  11.227229
1982            142  61.533197  10.770618
1987            142  63.212613  10.556285
1992            142  64.160338  11.227380
1997            142  65.014676  11.559439
2002            142  65.694923  12.279823
2007            142  67.007423  12.073021
```
### agg() ë©”ì„œë“œì— ë”•ì…”ë„ˆë¦¬ ì‚¬ìš©í•˜ê¸°
1. ë°ì´í„°í”„ë ˆì„ì— ì‚¬ìš©í•˜ê¸°
* ë°ì´í„°í”„ë ˆì„ì˜ ì—´ì„ keyë¡œ, ì§‘ê³„ í•¨ìˆ˜ë¥¼ valueë¡œ ì„¤ì •
* í•˜ë‚˜ ì´ìƒì˜ ë³€ìˆ˜ë¥¼ ê·¸ë£¹í™”í•˜ê³  ì—´ë³„ë¡œ ì„œë¡œ ë‹¤ë¥¸ ì§‘ê³„ í•¨ìˆ˜ë¥¼ ì ìš©í•  ìˆ˜ ìˆë‹¤
```python
gdf_dict = df.groupby("year").agg(
  {
    "lifeExp" : "mean",
    "pop" : "median",
    "gdpPercap" : "median"
  }
)

print(gdf_dict)
```
ğŸ“ ì‹¤í–‰ê²°ê³¼
```
        lifeExp         pop    gdpPercap
year                                    
1952  49.057620   3943953.0  1968.528344
1957  51.507401   4282942.0  2173.220291
1962  53.609249   4686039.5  2335.439533
1967  55.678290   5170175.5  2678.334740
1972  57.647386   5877996.5  3339.129407
1977  59.570157   6404036.5  3798.609244
1982  61.533197   7007320.0  4216.228428
1987  63.212613   7774861.5  4280.300366
1992  64.160338   8688686.5  4386.085502
1997  65.014676   9735063.5  4781.825478
2002  65.694923  10372918.5  5319.804524
2007  67.007423  10517531.0  6124.371108
```

2. ì‹œë¦¬ì¦ˆì— ì‚¬ìš©í•˜ê¸°
* ì›í•˜ëŠ” í•¨ìˆ˜ ëª©ë¡ì„ agg()ì— ì „ë‹¬í•˜ê³ ë‚˜ì„œ rename() ë©”ì„œë“œë¡œ ê²°ê³¼ ì—´ì˜ ì´ë¦„ì„ ë³€ê²½
```python
gdf = (
    df
    .groupby("year")
    ["lifeExp"]
    .agg(
        [
            np.count_nonzero,
            np.mean,
            np.std
        ]
    )
    .rename(
        columns={
              "count_nonzero" : "count"
              "mean" : avg"
              "std" : "std_dev"
            }
      )
      .reset_index()
)

print(gdf)
```
ğŸ“ ì‹¤í–‰ê²°ê³¼
```
    year  count        avg    std_dev
0   1952    142  49.057620  12.225956
1   1957    142  51.507401  12.231286
2   1962    142  53.609249  12.097245
3   1967    142  55.678290  11.718858
4   1972    142  57.647386  11.381953
5   1977    142  59.570157  11.227229
6   1982    142  61.533197  10.770618
7   1987    142  63.212613  10.556285
8   1992    142  64.160338  11.227380
9   1997    142  65.014676  11.559439
10  2002    142  65.694923  12.279823
11  2007    142  67.007423  12.073021
```
